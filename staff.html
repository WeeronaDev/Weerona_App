<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>WEE-MEALS - Staff</title>
	<link rel="icon" href="favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="css_staff.css" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
	<script async>
		// Initialize Firebase
		$(function() {
			console.log("initialize database");
			var config = {
				apiKey: "AIzaSyCu-niq7rlwyF6PGbrwNPzy9BSzP6o6z5M",
				authDomain: "weeronaapp.firebaseapp.com",
				databaseURL: "https://weeronaapp.firebaseio.com",
				projectId: "weeronaapp",
				storageBucket: "weeronaapp.appspot.com",
				messagingSenderId: "1093710876765"
			};
			firebase.initializeApp(config);
			var database = firebase.database();
		});
	</script>
</head>

<body>

	<script async>
		$(function() {		
			//Check initial auth status		
			firebase.auth().onAuthStateChanged(function(user) {
				if (user) {
					// User is signed in.						
					console.log("initial auth: user logged in as "+user.displayName);	
					$("#welcome_banner").show();
					$("#welcomeText").html("Logged in as: "+user.displayName+" ("+user.email+")");	
				} else {
					// No user is signed in.
					console.log("initial auth: user not logged in");	
					$("#login_banner").show();
				}
			});

			//Sign-out
		document.getElementById("btnLogout").addEventListener("click", function(signOut) {	
			firebase.auth().signOut().then(function() {
				console.log("Signed out");
				$("#welcome_banner").hide();
				$("#login_banner").show();
				$("#logout_banner").show();		
				window.location.replace("index.html");				
			}).catch(function(error) {
				console.log("Error signing out");
			});
		});	

		//Database read
		console.log("retrieve meals");
		var dbFoodRef = firebase.database().ref('orders');
		dbFoodRef.on('child_added', function(snap){
			var tr = $("<tr></tr>");
			tr.append($("<td></td>").text(snap.val().date));
			tr.append($("<td></td>").text(snap.val().time));
			tr.append($("<td></td>").text(snap.val().user));
			tr.append($("<td></td>").text(snap.val().main1));
			tr.append($("<td></td>").text(snap.val().main2));
			tr.append($("<td></td>").text(snap.val().vegan));
			tr.append($("<td></td>").text(snap.val().fish));
			tr.append($("<td></td>").text(snap.val().veg));
			tr.append($("<td></td>").text(snap.val().salad));
			tr.append($("<td></td>").text(snap.val().des));
			$("#orders").append(tr);
			$("#order_load").hide();
		});		
	});
	</script>
	
	<div id="header">
		<h1>WEE-MEALS Staff View</h1>
	</div>
	
	<div id="navigation">
		<p>You are here: <a href="index.html">WEE-MEALS Login</a> >> <a href="student.html">Staff - Manage late meal orders</a></p>
	</div>

	<div id="login_banner">
		<p>You are not logged in!</p>
		<form action="index.html">
			<input type="submit" value="Log-In" />
		</form>
	</div>
	
	<div id="welcome_banner">
		<p id="welcomeText"></p>
		<input type="submit" id="btnLogout" name="logout" value ="Log-Out">
	</div>
	
	<div id="logout_banner">
		<p>You have been logged out!</p>
	</div>
		
	<div id="content">
		<h3><img id='meal_icon' src="calendar-60x60.png" alt="Meal calendar" style="width:60px;height:60px;">VIEW LATE MEAL ORDERS</h3>
		<p><b>Pending late meal orders:</b></p>
		<br>
		<table border='1' id="orders">
			<tr>
				<th>Date</th>
				<th>Time</th>
				<th>Name</th>
				<th>Main1</th>
				<th>Main2</th>
				<th>Vegetarian</th>
				<th>Fish</th>
				<th>Vegetables</th>
				<th>Salad</th>
				<th>Dessert</th>
			</tr>
		</table>
		<br>
		<div id="order_load">
			<p><b>Loading orders...Please wait</b></p>
		</div>
		<br><br>
		<a href="index.html">Login</a>
		<a href="student.html">Students</a>
	</div>	
</body>
</html>